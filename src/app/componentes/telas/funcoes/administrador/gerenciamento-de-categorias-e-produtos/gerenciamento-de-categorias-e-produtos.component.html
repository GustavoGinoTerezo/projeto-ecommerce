<div class="divGeral">
  <h1>Gerenciamento de Categorias</h1>
  <div class="containerInputs">
    <div class="containerNomeProdutoECategoria">
      <div class="divInputNome">
        <span class="p-float-label">
          <input
            pInputText
            id="categoria"
            [(ngModel)]="nomeCategoriaSelecionada"
           />
          <label htmlFor="username">Nome da Categoria</label>
        </span>
      </div>
      <div class="divInputCpf">
        <p-dropdown
          [options]="categorias"
          [(ngModel)]="categoriasAdicionarSelecionadaInput"
          (onChange)="onCategoriaAdicionarSelect($event)"
          optionLabel="nome"
          [filter]="true"
          filterBy="nome"
          placeholder="Selecione a categoria"
        >
          <!-- Selected Item Template -->
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center gap-2" *ngIf="categoriasAdicionarSelecionadaInput">
              <div>{{ categoriasAdicionarSelecionadaInput.nome }}</div>
            </div>
          </ng-template>
          <!-- Item Template -->
          <ng-template let-categoria pTemplate="item">
            <div class="flex align-items-center gap-2">
              <div>{{ categoria.nome }}</div>
            </div>
          </ng-template>
        </p-dropdown>
      </div>
    </div>
  </div>

  <div class="containerBotoes">
    <div class="containerBotoesUm">
      <div class="divInputs">
        <p-button
          label="Adicionar categoria"
          [disabled]="adicionarCategoriaDisabled || categoriasAdicionarSelecionadaInput || !nomeCategoriaSelecionada"
          styleClass="p-button-raised p-button-success"
          (onClick)="adicionarCategoria()"
        ></p-button>
      </div>
      <div class="divInputs">
        <p-button
          label="Atualizar categoria"
          [disabled]="!categoriasAdicionarSelecionadaInput"
          styleClass="p-button-raised p-button-warning"
          (onClick)="atualizarCategoria()"
        ></p-button>
      </div>
    </div>
    <div class="containerBotoesDois">
      <div class="divInputs">
        <!-- <p-button
          label="Excluir categoria"
          [disabled]="!categoriasAdicionarSelecionadaInput"
          styleClass="p-button-raised p-button-danger"
          (onClick)="excluirCategoria()"
        ></p-button> -->
      </div>
      <div class="divInputs">
        <p-button
          label="Limpar campos"
          [disabled]="!nomeCategoriaSelecionada"
          (onClick)="limparCamposCategoriaNova()"
          styleClass="p-button-raised p-button-info"
        ></p-button>
      </div>
    </div>
  </div>

  <hr class="hr">
  <h1 class="h1">Gerenciamento de Produtos</h1>
  <div class="containerInputs">
    <div class="containerNomeProdutoECategoria">
      <div class="divInputNome">
        <span class="p-float-label">
          <input pInputText id="username" [(ngModel)]="nomeProduto" />
          <label htmlFor="username">Nome do Produto</label>
        </span>
      </div>
      <div class="divInputCpf">
        <p-dropdown
          [options]="categorias"
          [(ngModel)]="categoriasSelecionadaInput"
          (onChange)="onCategoriaAdicionarProdutoSelect($event)"
          optionLabel="nome"
          [filter]="true"
          filterBy="nome"
          placeholder="Selecione a categoria"
        >
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center gap-2" *ngIf="categoriasSelecionadaInput">
              <div>{{ categoriasSelecionadaInput.nome }}</div>
            </div>
          </ng-template>
          <ng-template let-categoria pTemplate="item">
            <div class="flex align-items-center gap-2">
              <div>{{ categoria.nome }}</div>
            </div>
          </ng-template>
        </p-dropdown>
      </div>
    </div>
    <div class="containerDimensionamento">
      <div class="containerPesoAltura">
        <div class="divInputPeso">
          <span class="p-float-label">
            <input pInputText id="peso" [(ngModel)]="pesoProduto" (keypress)="onKeyPress($event)" />
            <label htmlFor="peso">Peso do produto (kg)</label>
          </span>
        </div>
        <div class="divInputAltura">
          <span class="p-float-label">
            <input pInputText id="altura" [(ngModel)]="alturaProduto" (keypress)="onKeyPress($event)"/>
            <label htmlFor="altura">Altura do produto (cm)</label>
          </span>
        </div>
      </div>
      <div class="containerLarguraComprimento">
        <div class="divInputLargura">
          <span class="p-float-label">
            <input pInputText id="largura" [(ngModel)]="larguraProduto" (keypress)="onKeyPress($event)"/>
            <label htmlFor="largura">Largura do produto (cm)</label>
          </span>
        </div>
        <div class="divInputComprimento">
          <span class="p-float-label">
            <input pInputText id="comprimento" [(ngModel)]="comprimentoProduto" (keypress)="onKeyPress($event)"/>
            <label htmlFor="comprimento">Comprimento do produto (cm)</label>
          </span>
        </div>
      </div>
    </div>
    <div class="containerPrecoEStatus">
      <div class="divInputPreco">
        <div class="p-inputgroup">
          <span class="p-inputgroup-addon">R$</span>
          <input [(ngModel)]="valorProdutoFormatted" (keypress)="onKeyPress($event)" (input)="onValorProdutoInput($event)" pInputText placeholder="Preço"/>
        </div>
      </div>
      <div class="divInputDropDown">
        <p-dropdown
          [options]="status"
          placeholder="Selecione o status"
          [(ngModel)]="selectedStatus"
          [showClear]="true"
          optionLabel="nome"
        ></p-dropdown>
      </div>
      <div class="divInputDropDown">
        <p-dropdown
          [options]="layout"
          placeholder="Selecione o layout"
          [(ngModel)]="selectedLayout"
          [showClear]="true"
          optionLabel="nome"
        ></p-dropdown>
      </div>
    </div>
    <div class="containerDescEFotos">
      <div class="containerDescs">
        <div class="containerDescricoes">
          <div class="divInputCep">
            <span class="p-float-label">
              <input pInputText id="username" [(ngModel)]="descBreve" />
              <label htmlFor="username">Descrição breve do produto</label>
            </span>
          </div>
        </div>
        <div class="containerDescricoes">
          <div class="divInputCidade">
            <span class="p-float-label">
              <textarea
                id="float-input"
                rows="5"
                cols="30"
                pInputTextarea
                [autoResize]="true"
                [(ngModel)]="descCompleta"
              ></textarea>
              <label class="labelDescCompleta" for="float-input">Descrição completa do produto</label>
            </span>
          </div>
        </div>
        <div class="containerDescricoes">
          <div class="divInputCidade">
            <span class="p-float-label">
              <textarea
                id="float-input"
                rows="5"
                cols="30"
                pInputTextarea
                [autoResize]="true"
                [(ngModel)]="informacaoTecnica"
              ></textarea>
              <label class="labelDescCompleta" for="float-input">Informação técnica do produto</label>
            </span>
          </div>
        </div>
      </div>

      <div class="containerUploadFoto">
        <div class="fileUploadFotos scrollwrap">
          <p-fileUpload
          chooseLabel="Selecionar"
          chooseIcon="fa-solid fa-plus"
          cancelLabel="Cancelar"
          [showUploadButton]="false"
          name="myfile[]"
          [multiple]="true"
          accept="image/*"
          [maxFileSize]="100000000"
          (onSelect)="onUpload($event)"
          >
            <ng-template pTemplate="toolbar">
              <div class="labelFotos">
                Escolher fotos do produto
              </div>
            </ng-template>
            <ng-template let-file pTemplate="content">
              <div *ngFor="let image of selectedProductImagesTemplate" class="containerImagem">
                <img class="img" [src]="image.imagem" alt="Product Image" />
                <p-button label="Excluir" icon="fa-solid fa-xmark"></p-button>
              </div>
              <div>{{file.name}}</div>
            </ng-template>
          </p-fileUpload>
        </div>

        <div class="fileUploadFormulacao scrollwrap">
          <p-fileUpload 
            chooseLabel="Selecionar" 
            chooseIcon="fa-solid fa-plus"  
            cancelLabel="Cancelar" 
            [showUploadButton]="false" 
            name="myfile[]" 
            url="https://www.primefaces.org/cdn/api/upload.php" 
            [multiple]="true" 
            accept="image/*" 
            [maxFileSize]="100000000"
            (onSelect)="onUploadFormulacao($event)">
              <ng-template pTemplate="toolbar">
                <div class="labelFotos">
                  Escolher formulação do produto
                </div>
              </ng-template>
              <ng-template let-file pTemplate="file">
                <div>{{file.name}}</div>
            </ng-template>
          </p-fileUpload>
        </div>

        <div class="botaoAdicionarFotos">
          <p-button (onClick)="adicionarFotoAoProduto()" [disabled]="selectedProductImages.length === 0 && selectedProductImagesFormulacao.length === 0" *ngIf="habilitarBotao" label="Adicionar fotos"></p-button>
        </div>
      </div>
    </div>
  </div>
  <div class="containerBotoesAdicionarProdutos">
    <div class="containerBotoesUm">
      <div class="divInputs">
        <p-button label="Adicionar produto"
          [disabled]="
          adicionarProdutoDisabled ||
          !nomeProduto ||
          !pesoProduto ||
          !alturaProduto ||
          !larguraProduto ||
          !comprimentoProduto ||
          !categoriasSelecionadaInput ||
          !valorProdutoFormatted ||
          !selectedStatus ||
          !selectedLayout ||
          !descBreve ||
          !descCompleta ||
          !informacaoTecnica"
          styleClass="p-button-raised p-button-success"
          (onClick)="adicionarProduto()"
        ></p-button>
      </div>
      <div class="divInputs">
        <p-button label="Atualizar produto"
          [disabled]="
          !adicionarProdutoDisabled ||
          !nomeProduto ||
          !pesoProduto ||
          !alturaProduto ||
          !larguraProduto ||
          !comprimentoProduto ||
          !categoriasSelecionadaInput ||
          !valorProdutoFormatted ||
          !selectedStatus ||
          !selectedLayout ||
          !descBreve ||
          !descCompleta ||
          !informacaoTecnica"
          styleClass="p-button-raised p-button-warning"
          (onClick)="atualizarProduto()"
        ></p-button>
      </div>
    </div>
    <div class="containerBotoesDois">
      <div class="divInputs">
        <!-- <p-button label="Excluir produto"
          [disabled]="
          !adicionarProdutoDisabled ||
          !nomeProduto ||
          !pesoProduto ||
          !alturaProduto ||
          !larguraProduto ||
          !comprimentoProduto ||
          !categoriasSelecionadaInput ||
          !valorProdutoFormatted ||
          !selectedStatus ||
          !selectedLayout ||
          !descBreve ||
          !descCompleta ||
          !informacaoTecnica"
          styleClass="p-button-raised p-button-danger"
          (onClick)="excluirProduto()">
        </p-button> -->
      </div>
      <div class="divInputs">
        <p-button
          label="Limpar campos"
          [disabled]="
          !nomeProduto &&
          !pesoProduto &&
          !alturaProduto &&
          !larguraProduto &&
          !comprimentoProduto &&
          !categoriasSelecionadaInput &&
          !valorProdutoFormatted &&
          !selectedStatus &&
          !selectedLayout &&
          !descBreve &&
          !descCompleta &&
          !informacaoTecnica"
          (onClick)="limparCampos()"
          styleClass="p-button-raised p-button-info"
        ></p-button>
      </div>
    </div>
  </div>
  <div class="tabelaClientes">
    <p-table
      #dt
      [value]="produtos"
      selectionMode="single"
      [(selection)]="categoriasSelecionada"
      [rowHover]="true"
      [tableStyle]="{ 'min-width': '50rem' }"
      [paginator]="true"
      [rows]="5"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
      [rowsPerPageOptions]="[5, 10, 15]"
      [filterDelay]="0"
      (onRowCollapse)="onRowCollapse()"
      dataKey="nome"
    >
      <ng-template pTemplate="caption">
        <div class="table-header">
          <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input pInputText type="text" (input)="filterTable($event)" placeholder="Buscar Produto" />
          </span>
        </div>
      </ng-template>
      <ng-template pTemplate="header">
        <tr>
          <th>Produto</th>
          <th>Status</th>
          <th>Categoria</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-produto let-expanded="expanded">
        <tr [pSelectableRow]="produto"  [pRowToggler]="produto" (click)="updateInputFieldsWithSelectedProduct(produto)">
          <td>{{ produto?.nome }}</td>
          <td>{{ mapStatusName(produto?.status) }}</td>
          <td>{{ mapCategoryName(produto?.catId) }}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="rowexpansion" let-produto>
        <tr *ngIf="expandSelectedProductId === produto.prodId">
          <td colspan="8">
            <div class="p-3">
              <p-table
              [value]="tipo1Fotos"
              [paginator]="true"
              [rowsPerPageOptions]="[5, 10, 15]"
              [rows]="5"
              dataKey="prodId"
              >
                <ng-template pTemplate="caption">
                  <div class="table-header">
                    <div>
                      Fotos do produto
                    </div>
                  </div>
                </ng-template>
                <ng-template pTemplate="header">
                  <tr>
                    <th>Imagem</th>
                    <th>Excluir imagem</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-imagem>
                  <tr>
                    <td><img class="img" [src]="pegarImagemURL(imagem)" alt="Imagem"></td>
                    <td><p-button (onClick)="excluirFotoPorID(imagem)" styleClass="p-button-danger" icon="fa-solid fa-trash"></p-button></td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="6">Nenhuma imagem do produto.</td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </td>
        </tr>
        <tr *ngIf="expandSelectedProductId === produto.prodId">
          <td colspan="8">
            <div class="p-3">
              <p-table
              [value]="tipo2Fotos"
              [paginator]="true"
              [rowsPerPageOptions]="[5, 10, 15]"
              [rows]="5"
              dataKey="prodId"
              >
                <ng-template pTemplate="caption">
                  <div class="table-header">
                    <div>
                      Formulação do produto
                    </div>
                  </div>
                </ng-template>
                <ng-template pTemplate="header">
                  <tr>
                    <th>Formulação</th>
                    <th>Excluir formulação</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-imagemFormulacao>
                  <tr>
                    <td><img class="img" [src]="pegarImagemURL(imagemFormulacao)" alt="Imagem"></td>
                    <td><p-button (onClick)="excluirFotoPorID(imagemFormulacao)" styleClass="p-button-danger" icon="fa-solid fa-trash"></p-button></td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                  <tr>
                    <td colspan="6">Nenhuma formulação do produto.</td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </td>
        </tr>
  
      </ng-template>
    </p-table>
  </div>
</div>

